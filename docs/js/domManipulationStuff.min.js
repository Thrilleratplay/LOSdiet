var selectedApks=JSON.parse(localStorage.getItem("LOSdiet.apks"))||[],manuallyEnteredApks=JSON.parse(localStorage.getItem("LOSdiet.user_added_apks"))||[],apkListContainer=document.querySelector(".apk-containter"),userApkContainer=document.querySelector(".user-apks-container"),userApkTextarea=userApkContainer.querySelector("textarea"),makeZipButton=document.querySelector('input[type=button][value="Make Zip"]'),filterList=document.querySelector(".filter-list"),apkData;userApkTextarea.value=manuallyEnteredApks.join("\n");var disableMakeZipButton=function(){makeZipButton.disabled=0===selectedApks.length},isApkSelected=function(e){return-1!==selectedApks.indexOf(e.name)},filterApkList=function(e){return isApkSelected(e)||(!e.expertOnly||filterList.querySelector('input[name="expertMode"]:checked'))&&!e.isGoogleApp&&!e.isCM13Only},renderApkList=function(){var e=['<div class="row app-list">','<div class="col s12 m6 l4">','<input type="checkbox" id="<%= apk.name %>" ','<%=(isSelected ? "checked=true": "")%> ',"/>",'<label for="<%= apk.name %>">','<div class="apk-label truncate"><%= apk.label %></div>',"</label>","<div>",'<%-(apk.expertOnly ? \'<span class="chip red">Danger</span>\': "")%> ',"</div>","</div>",'<div class="col hide-on-med-and-down l3">','<div class="truncate">',"<%= apk.packageName %>","</div>",'<div class="truncate">',"<%= apk.name %>.apk</div>","</div>",'<div class="col m6 l5">',"<%= apk.description %>","</div>","</div>"].join("");apkListContainer.innerHTML=apkData.filter(filterApkList).map(function(t){return ejs.render(e,{apk:t,isSelected:isApkSelected(t)})}).join(""),Array.prototype.map.call(apkListContainer.querySelectorAll("input[type=checkbox]"),function(e){e.addEventListener("change",function(){var e=selectedApks.indexOf(this.id);e>-1?selectedApks.splice(e,1):selectedApks.push(this.id),disableMakeZipButton()})}),disableMakeZipButton(),filterList.querySelector('input[name="expertMode"]:checked')||userApkTextarea.value?userApkTextarea.classList.remove("hide"):userApkTextarea.classList.add("hide")},getApkJson=function(){var e=new XMLHttpRequest;e.open("GET","./apkData.json",!0),e.onload=function(){e.status>=200&&e.status<400&&(apkData=JSON.parse(e.responseText),renderApkList())},e.send()},formatUserApkTextarea=function(){manuallyEnteredApks=this.value.split(/\W/).filter(function(e){return e}),this.value=manuallyEnteredApks.join("\n")};filterList.querySelector('input[name="expertMode"]').onchange=renderApkList,userApkTextarea.onblur=formatUserApkTextarea,getApkJson();